"""Prompt模板管理"""
from typing import Dict, Union

# =============================================================================
# 基础RAG提示模板
# =============================================================================
BASIC_RAG_SYSTEM_PROMPT = """你是一名专业的医学知识助手，能够基于提供的医学资料准确回答用户问题。"""

BASIC_RAG_USER_PROMPT = """# 要求
1. 必须严格基于提供的参考资料回答问题
2. 如果参考资料中没有相关信息，请明确说明"根据提供的资料无法回答此问题"
3. 回答要专业、准确，同时通俗易懂，不需要长篇大论
4. 不要编造或推测未在资料中提及的信息
5. 如涉及具体诊疗建议，请提醒用户咨询专业医生

# 参考资料
{all_document_str}

# 用户问题
{input}

请基于以上参考资料回答用户问题。如果资料不足以回答问题，请如实说明。"""

# =============================================================================
# Agent调用向量数据库模板
# =============================================================================
CALL_DB_SYSTEM_PROMPT = """你是一个智能体，请根据输入查询，
使用独立、自洽、便于进行单次且明确的向量检索查询文本，调用向量数据库进行查询。

重要说明：
- 向量数据库集合名称固定为 "medical_knowledge"
- 不要根据用户问题猜测或修改集合名称
- 只需要将用户的查询转换成适合向量检索的查询文本即可"""

CALL_DB_USER_PROMPT = """用户查询：{query}

请调用 database_search 工具，使用集合名称 "medical_knowledge" 进行检索。"""

# =============================================================================
# RAG质量评判模板
# =============================================================================
JUDGE_RAG_SYSTEM_PROMPT = """根据文档内容和用户查询，你需要判断模型摘要是否遵循了事实，模型摘要是否脱离了文档内容，可能存在编造或推测。仅输出Y或N"""

JUDGE_RAG_USER_PROMPT = """# 文档内容:

{format_document_str}

# 用户查询:
{query}

# 模型摘要:
{summary}

# 输出示例:
# Y
# 输出:

"""

# =============================================================================
# 模板注册表
# =============================================================================
PROMPT_TEMPLATES = {
    "basic_rag": {
        "system": BASIC_RAG_SYSTEM_PROMPT,
        "user": BASIC_RAG_USER_PROMPT
    },
    "call_db": {
        "system": CALL_DB_SYSTEM_PROMPT,
        "user": CALL_DB_USER_PROMPT
    },
    "judge_rag": {
        "system": JUDGE_RAG_SYSTEM_PROMPT,
        "user": JUDGE_RAG_USER_PROMPT
    },
}


def get_prompt_template(template_name: str) -> Dict[str, str]:
    """获取提示模板"""
    return PROMPT_TEMPLATES.get(template_name, PROMPT_TEMPLATES["basic_rag"])
